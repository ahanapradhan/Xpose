SELECT COALESCE(channel, 'Total') AS channel, COALESCE(identifier::VARCHAR, 'Total') AS identifier, SUM(total_sales) AS total_sales, SUM(total_returns) AS total_returns, SUM(net_profit) AS net_profit FROM ( SELECT 'Store' AS channel, ss_store_sk::VARCHAR AS identifier, SUM(ss_net_paid) AS total_sales, SUM(sr_return_amt) AS total_returns, SUM(ss_net_profit) AS net_profit FROM store_sales JOIN store_returns ON ss_sold_date_sk = sr_returned_date_sk AND ss_item_sk = sr_item_sk AND ss_store_sk = sr_store_sk JOIN date_dim ON ss_sold_date_sk = d_date_sk WHERE d_date BETWEEN '2001-08-16' AND '2001-09-14' GROUP BY ss_store_sk UNION ALL SELECT 'Catalog' AS channel, cp_catalog_page_id AS identifier, SUM(cs_net_paid) AS total_sales, SUM(cr_return_amount) AS total_returns, SUM(cs_net_profit) AS net_profit FROM catalog_sales JOIN catalog_returns ON cs_sold_date_sk = cr_returned_date_sk AND cs_item_sk = cr_item_sk AND cs_catalog_page_sk = cr_catalog_page_sk JOIN date_dim ON cs_sold_date_sk = d_date_sk JOIN catalog_page ON cs_catalog_page_sk = cp_catalog_page_sk WHERE d_date BETWEEN '2001-08-16' AND '2001-09-14' GROUP BY cp_catalog_page_id UNION ALL SELECT 'Web' AS channel, wp_web_page_id AS identifier, SUM(ws_net_paid) AS total_sales, SUM(wr_return_amt) AS total_returns, SUM(ws_net_profit) AS net_profit FROM web_sales JOIN web_returns ON ws_sold_date_sk = wr_returned_date_sk AND ws_item_sk = wr_item_sk AND ws_web_page_sk = wr_web_page_sk JOIN date_dim ON ws_sold_date_sk = d_date_sk JOIN web_page ON ws_web_page_sk = wp_web_page_sk WHERE d_date BETWEEN '2001-08-16' AND '2001-09-14' GROUP BY wp_web_page_id ) AS combined_data GROUP BY ROLLUP(channel, identifier) ORDER BY channel, identifier LIMIT 100;
