SELECT COALESCE(channel, 'Total') AS channel, COALESCE(CAST(id AS VARCHAR), 'Total') AS id, SUM(sales) AS total_sales, SUM(returns) AS total_returns, SUM(net_profit) AS total_net_profit FROM ( SELECT 'Store' AS channel, CAST(s_store_id AS VARCHAR) AS id, ss_ext_sales_price AS sales, COALESCE(sr_return_amt, 0) AS returns, ss_net_profit AS net_profit FROM store_sales JOIN store ON ss_store_sk = s_store_sk LEFT JOIN store_returns ON ss_item_sk = sr_item_sk AND ss_ticket_number = sr_ticket_number JOIN item ON ss_item_sk = i_item_sk JOIN date_dim ON ss_sold_date_sk = d_date_sk WHERE i_current_price > 50 AND d_date BETWEEN '2000-08-26' AND '2000-09-24' AND ss_promo_sk NOT IN (SELECT p_promo_sk FROM promotion WHERE p_channel_tv = 'Y') UNION ALL SELECT 'Catalog' AS channel, cp_catalog_page_id AS id, cs_ext_sales_price AS sales, COALESCE(cr_return_amount, 0) AS returns, cs_net_profit AS net_profit FROM catalog_sales JOIN catalog_page ON cs_catalog_page_sk = cp_catalog_page_sk LEFT JOIN catalog_returns ON cs_item_sk = cr_item_sk AND cs_order_number = cr_order_number JOIN item ON cs_item_sk = i_item_sk JOIN date_dim ON cs_sold_date_sk = d_date_sk WHERE i_current_price > 50 AND d_date BETWEEN '2000-08-26' AND '2000-09-24' AND cs_promo_sk NOT IN (SELECT p_promo_sk FROM promotion WHERE p_channel_tv = 'Y') UNION ALL SELECT 'Web' AS channel, CAST(ws_web_site_sk AS VARCHAR) AS id, ws_ext_sales_price AS sales, COALESCE(wr_return_amt, 0) AS returns, ws_net_profit AS net_profit FROM web_sales JOIN web_site ON ws_web_site_sk = web_site_sk LEFT JOIN web_returns ON ws_item_sk = wr_item_sk AND ws_order_number = wr_order_number JOIN item ON ws_item_sk = i_item_sk JOIN date_dim ON ws_sold_date_sk = d_date_sk WHERE i_current_price > 50 AND d_date BETWEEN '2000-08-26' AND '2000-09-24' AND ws_promo_sk NOT IN (SELECT p_promo_sk FROM promotion WHERE p_channel_tv = 'Y') ) AS sales_data GROUP BY ROLLUP(channel, id) ORDER BY channel, id LIMIT 100;
