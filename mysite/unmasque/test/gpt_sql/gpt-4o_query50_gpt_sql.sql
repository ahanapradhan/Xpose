SELECT s.s_store_name, s.s_company_id, CONCAT(s.s_street_number, ' ', s.s_street_name, ' ', s.s_street_type, ', ', s.s_city, ', ', s.s_state, ' ', s.s_zip) AS store_address, SUM(CASE WHEN d1.d_date - d2.d_date <= 30 THEN sr_return_quantity ELSE 0 END) AS returns_within_30_days, SUM(CASE WHEN d1.d_date - d2.d_date BETWEEN 31 AND 60 THEN sr_return_quantity ELSE 0 END) AS returns_31_60_days, SUM(CASE WHEN d1.d_date - d2.d_date BETWEEN 61 AND 90 THEN sr_return_quantity ELSE 0 END) AS returns_61_90_days, SUM(CASE WHEN d1.d_date - d2.d_date BETWEEN 91 AND 120 THEN sr_return_quantity ELSE 0 END) AS returns_91_120_days, SUM(CASE WHEN d1.d_date - d2.d_date > 120 THEN sr_return_quantity ELSE 0 END) AS returns_over_120_days FROM store_returns sr JOIN store_sales ss ON sr.sr_ticket_number = ss.ss_ticket_number JOIN date_dim d1 ON sr.sr_returned_date_sk = d1.d_date_sk JOIN date_dim d2 ON ss.ss_sold_date_sk = d2.d_date_sk JOIN store s ON sr.sr_store_sk = s.s_store_sk WHERE d1.d_year = 2002 AND d1.d_moy = 9 GROUP BY s.s_store_name, s.s_company_id, store_address ORDER BY s.s_store_name, s.s_company_id, store_address LIMIT 100;
