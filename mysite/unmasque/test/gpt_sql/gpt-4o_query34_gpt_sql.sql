SELECT c.c_last_name, c.c_first_name, c.c_salutation, c.c_preferred_cust_flag, ss.ss_ticket_number FROM customer c JOIN store_sales ss ON c.c_customer_sk = ss.ss_customer_sk JOIN date_dim d ON ss.ss_sold_date_sk = d.d_date_sk JOIN store s ON ss.ss_store_sk = s.s_store_sk JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk WHERE d.d_year BETWEEN 1999 AND 2001 AND d.d_dom IN (1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31) AND s.s_county = 'Williamson' AND cd.cd_purchase_estimate > 1000  -- Assuming 'High' corresponds to a numeric value greater than 1000 AND hd.hd_vehicle_count > hd.hd_dep_count GROUP BY c.c_customer_sk, c.c_last_name, c.c_first_name, c.c_salutation, c.c_preferred_cust_flag, ss.ss_ticket_number HAVING COUNT(ss.ss_ticket_number) BETWEEN 15 AND 20 ORDER BY c.c_last_name, c.c_first_name, c.c_salutation, c.c_preferred_cust_flag DESC;
