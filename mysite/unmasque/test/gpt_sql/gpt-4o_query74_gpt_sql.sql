WITH sales_1999 AS ( SELECT c_customer_sk, SUM(ws_net_paid) AS web_sales_1999, SUM(ss_net_paid) AS store_sales_1999 FROM customer LEFT JOIN web_sales ON c_customer_sk = ws_bill_customer_sk LEFT JOIN store_sales ON c_customer_sk = ss_customer_sk LEFT JOIN date_dim d1 ON ws_sold_date_sk = d1.d_date_sk AND d1.d_year = 1999 LEFT JOIN date_dim d2 ON ss_sold_date_sk = d2.d_date_sk AND d2.d_year = 1999 GROUP BY c_customer_sk ), sales_2000 AS ( SELECT c_customer_sk, SUM(ws_net_paid) AS web_sales_2000, SUM(ss_net_paid) AS store_sales_2000 FROM customer LEFT JOIN web_sales ON c_customer_sk = ws_bill_customer_sk LEFT JOIN store_sales ON c_customer_sk = ss_customer_sk LEFT JOIN date_dim d1 ON ws_sold_date_sk = d1.d_date_sk AND d1.d_year = 2000 LEFT JOIN date_dim d2 ON ss_sold_date_sk = d2.d_date_sk AND d2.d_year = 2000 GROUP BY c_customer_sk ), sales_growth AS ( SELECT s1999.c_customer_sk, (s2000.web_sales_2000 - s1999.web_sales_1999) / NULLIF(s1999.web_sales_1999, 0) AS web_growth_rate, (s2000.store_sales_2000 - s1999.store_sales_1999) / NULLIF(s1999.store_sales_1999, 0) AS store_growth_rate FROM sales_1999 s1999 JOIN sales_2000 s2000 ON s1999.c_customer_sk = s2000.c_customer_sk ) SELECT c.c_customer_id, c.c_first_name, c.c_last_name FROM sales_growth sg JOIN customer c ON sg.c_customer_sk = c.c_customer_sk WHERE sg.web_growth_rate > sg.store_growth_rate ORDER BY c.c_customer_id, c.c_first_name, c.c_last_name LIMIT 100;
