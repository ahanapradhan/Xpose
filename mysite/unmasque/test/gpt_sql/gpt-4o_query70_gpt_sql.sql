SELECT ca_state, ca_county, SUM(ss_net_profit) AS total_net_profit, RANK() OVER (PARTITION BY ca_state ORDER BY SUM(ss_net_profit) DESC) AS county_rank, DENSE_RANK() OVER (ORDER BY SUM(ss_net_profit) DESC) AS state_rank FROM store_sales JOIN customer_address ON store_sales.ss_addr_sk = customer_address.ca_address_sk JOIN date_dim ON store_sales.ss_sold_date_sk = date_dim.d_date_sk WHERE date_dim.d_date BETWEEN DATE '2022-01-01' AND DATE '2022-12-31' GROUP BY ca_state, ca_county ORDER BY state_rank, county_rank LIMIT 100;
