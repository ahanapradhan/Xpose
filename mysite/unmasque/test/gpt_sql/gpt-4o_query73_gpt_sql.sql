SELECT c.c_last_name, c.c_first_name, c.c_salutation, c.c_preferred_cust_flag, ss.ss_ticket_number FROM store_sales ss JOIN customer c ON ss.ss_customer_sk = c.c_customer_sk JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN date_dim d ON ss.ss_sold_date_sk = d.d_date_sk JOIN store s ON ss.ss_store_sk = s.s_store_sk WHERE ca.ca_county = 'Williamson' AND d.d_year IN (2000, 2001, 2002) AND d.d_dom IN (1, 2) AND (cd.cd_purchase_estimate IN (1, 2)) -- Assuming 1 represents 'High' and 2 represents 'Low' AND hd.hd_vehicle_count >= 1 GROUP BY c.c_last_name, c.c_first_name, c.c_salutation, c.c_preferred_cust_flag, ss.ss_ticket_number HAVING COUNT(ss.ss_ticket_number) BETWEEN 1 AND 5 ORDER BY COUNT(ss.ss_ticket_number) DESC, c.c_last_name ASC;
