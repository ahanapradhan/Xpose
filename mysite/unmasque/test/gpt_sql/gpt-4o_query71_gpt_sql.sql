SELECT i.i_brand, i.i_brand_id, t.t_hour, t.t_minute, SUM(COALESCE(cs.cs_ext_sales_price, 0) + COALESCE(ss.ss_ext_sales_price, 0) + COALESCE(ws.ws_ext_sales_price, 0)) AS total_sales_revenue FROM item i LEFT JOIN catalog_sales cs ON i.i_item_sk = cs.cs_item_sk LEFT JOIN store_sales ss ON i.i_item_sk = ss.ss_item_sk LEFT JOIN web_sales ws ON i.i_item_sk = ws.ws_item_sk JOIN time_dim t ON (cs.cs_sold_time_sk = t.t_time_sk OR ss.ss_sold_time_sk = t.t_time_sk OR ws.ws_sold_time_sk = t.t_time_sk) JOIN date_dim d ON (cs.cs_sold_date_sk = d.d_date_sk OR ss.ss_sold_date_sk = d.d_date_sk OR ws.ws_sold_date_sk = d.d_date_sk) WHERE i.i_manager_id = 1 AND d.d_year = 2001 AND d.d_moy = 11 AND t.t_meal_time IN ('breakfast', 'dinner') GROUP BY i.i_brand, i.i_brand_id, t.t_hour, t.t_minute ORDER BY total_sales_revenue DESC, i.i_brand_id;
