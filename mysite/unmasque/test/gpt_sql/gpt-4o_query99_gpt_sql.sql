SELECT LEFT(w.w_warehouse_name, 20) AS warehouse_name, sm.sm_type AS shipping_mode, cc.cc_name AS call_center_name, COUNT(*) AS total_sales, SUM(CASE WHEN d2.d_date - d1.d_date <= 30 THEN 1 ELSE 0 END) AS within_30_days, SUM(CASE WHEN d2.d_date - d1.d_date BETWEEN 31 AND 60 THEN 1 ELSE 0 END) AS between_31_60_days, SUM(CASE WHEN d2.d_date - d1.d_date BETWEEN 61 AND 90 THEN 1 ELSE 0 END) AS between_61_90_days, SUM(CASE WHEN d2.d_date - d1.d_date BETWEEN 91 AND 120 THEN 1 ELSE 0 END) AS between_91_120_days, SUM(CASE WHEN d2.d_date - d1.d_date > 120 THEN 1 ELSE 0 END) AS over_120_days FROM catalog_sales cs JOIN date_dim d1 ON cs.cs_sold_date_sk = d1.d_date_sk JOIN date_dim d2 ON cs.cs_ship_date_sk = d2.d_date_sk JOIN warehouse w ON cs.cs_warehouse_sk = w.w_warehouse_sk JOIN ship_mode sm ON cs.cs_ship_mode_sk = sm.sm_ship_mode_sk JOIN call_center cc ON cs.cs_call_center_sk = cc.cc_call_center_sk GROUP BY LEFT(w.w_warehouse_name, 20), sm.sm_type, cc.cc_name ORDER BY total_sales DESC LIMIT 100;
