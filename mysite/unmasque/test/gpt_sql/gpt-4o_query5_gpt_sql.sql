SELECT channel, id, SUM(total_sales) AS total_sales, SUM(total_returns) AS total_returns, SUM(adjusted_profit) AS adjusted_profit FROM ( SELECT 'store' AS channel, ss_store_sk AS id, SUM(ss_net_paid) AS total_sales, SUM(sr_return_amt) AS total_returns, SUM(ss_net_profit - sr_net_loss) AS adjusted_profit FROM store_sales JOIN store_returns ON ss_item_sk = sr_item_sk AND ss_ticket_number = sr_ticket_number JOIN date_dim ON ss_sold_date_sk = d_date_sk WHERE d_date BETWEEN '2002-08-22' AND '2002-09-04' GROUP BY ss_store_sk UNION ALL SELECT 'catalog' AS channel, cs_catalog_page_sk AS id, SUM(cs_net_paid) AS total_sales, SUM(cr_return_amount) AS total_returns, SUM(cs_net_profit - cr_net_loss) AS adjusted_profit FROM catalog_sales JOIN catalog_returns ON cs_item_sk = cr_item_sk AND cs_order_number = cr_order_number JOIN date_dim ON cs_sold_date_sk = d_date_sk WHERE d_date BETWEEN '2002-08-22' AND '2002-09-04' GROUP BY cs_catalog_page_sk UNION ALL SELECT 'web' AS channel, ws_web_site_sk AS id, SUM(ws_net_paid) AS total_sales, SUM(wr_return_amt) AS total_returns, SUM(ws_net_profit - wr_net_loss) AS adjusted_profit FROM web_sales JOIN web_returns ON ws_item_sk = wr_item_sk AND ws_order_number = wr_order_number JOIN date_dim ON ws_sold_date_sk = d_date_sk WHERE d_date BETWEEN '2002-08-22' AND '2002-09-04' GROUP BY ws_web_site_sk ) AS combined_data GROUP BY ROLLUP(channel, id) ORDER BY channel, id LIMIT 100;
