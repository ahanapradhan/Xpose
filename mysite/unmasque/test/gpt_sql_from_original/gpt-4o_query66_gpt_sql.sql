WITH sales_data AS ( SELECT w.w_warehouse_id, d.d_month_seq, SUM(cs.cs_sales_price) AS catalog_sales, SUM(cs.cs_net_paid_inc_tax) AS catalog_profit, SUM(ws.ws_ext_sales_price) AS web_sales, SUM(ws.ws_net_paid) AS web_profit FROM warehouse w JOIN catalog_sales cs ON w.w_warehouse_sk = cs.cs_warehouse_sk JOIN web_sales ws ON w.w_warehouse_sk = ws.ws_warehouse_sk JOIN date_dim d ON cs.cs_sold_date_sk = d.d_date_sk AND ws.ws_sold_date_sk = d.d_date_sk JOIN time_dim t ON cs.cs_sold_time_sk = t.t_time_sk AND ws.ws_sold_time_sk = t.t_time_sk WHERE d.d_year = 2001 AND t.t_time BETWEEN 30838 AND 30838 + 28800 GROUP BY w.w_warehouse_id, d.d_month_seq ) SELECT w_warehouse_id, d_month_seq, catalog_sales, catalog_profit, web_sales, web_profit FROM sales_data ORDER BY w_warehouse_id, d_month_seq;
