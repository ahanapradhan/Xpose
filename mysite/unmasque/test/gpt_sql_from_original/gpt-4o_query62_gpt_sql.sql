SELECT w.w_warehouse_id, sm.sm_ship_mode_id, ws.ws_web_site_sk, SUM(CASE WHEN dd.d_date - sd.d_date BETWEEN 0 AND 30 THEN 1 ELSE 0 END) AS "0-30 Days", SUM(CASE WHEN dd.d_date - sd.d_date BETWEEN 31 AND 60 THEN 1 ELSE 0 END) AS "31-60 Days", SUM(CASE WHEN dd.d_date - sd.d_date BETWEEN 61 AND 90 THEN 1 ELSE 0 END) AS "61-90 Days", SUM(CASE WHEN dd.d_date - sd.d_date BETWEEN 91 AND 120 THEN 1 ELSE 0 END) AS "91-120 Days", SUM(CASE WHEN dd.d_date - sd.d_date > 120 THEN 1 ELSE 0 END) AS "Over 120 Days" FROM web_sales ws JOIN date_dim sd ON ws.ws_sold_date_sk = sd.d_date_sk JOIN date_dim dd ON ws.ws_ship_date_sk = dd.d_date_sk JOIN warehouse w ON ws.ws_warehouse_sk = w.w_warehouse_sk JOIN ship_mode sm ON ws.ws_ship_mode_sk = sm.sm_ship_mode_sk WHERE sd.d_year = 2023 GROUP BY w.w_warehouse_id, sm.sm_ship_mode_id, ws.ws_web_site_sk;
