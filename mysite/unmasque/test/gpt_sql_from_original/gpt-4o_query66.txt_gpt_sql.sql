WITH sales_data AS ( SELECT d.d_month_seq, w.w_warehouse_id, SUM(cs.cs_sales_price) AS catalog_sales, SUM(cs.cs_net_paid_inc_tax) AS catalog_profit, SUM(ws.ws_ext_sales_price) AS web_sales, SUM(ws.ws_net_paid) AS web_profit FROM date_dim d JOIN catalog_sales cs ON d.d_date_sk = cs.cs_sold_date_sk JOIN web_sales ws ON d.d_date_sk = ws.ws_sold_date_sk JOIN time_dim t ON cs.cs_sold_time_sk = t.t_time_sk JOIN warehouse w ON cs.cs_warehouse_sk = w.w_warehouse_sk WHERE d.d_year = 2001 AND t.t_time BETWEEN 30838 AND 30838 + 28800 GROUP BY d.d_month_seq, w.w_warehouse_id ) SELECT d_month_seq, w_warehouse_id, catalog_sales, catalog_profit, web_sales, web_profit FROM sales_data ORDER BY d_month_seq, w_warehouse_id;
