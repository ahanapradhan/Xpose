SELECT s.s_store_id FROM store_sales ss JOIN store s ON ss.ss_store_sk = s.s_store_sk JOIN date_dim d ON ss.ss_sold_date_sk = d.d_date_sk WHERE d.d_year = 2022 GROUP BY s.s_store_id, s.s_store_sk HAVING SUM(ss.ss_quantity) < ( SELECT SUM(ss2.ss_quantity) FROM store_sales ss2 JOIN date_dim d2 ON ss2.ss_sold_date_sk = d2.d_date_sk WHERE ss2.ss_store_sk = s.s_store_sk AND d2.d_year = 2023 GROUP BY ss2.ss_store_sk ) UNION SELECT s.s_store_id FROM catalog_sales cs JOIN store s ON cs.cs_call_center_sk = s.s_store_sk JOIN date_dim d ON cs.cs_sold_date_sk = d.d_date_sk WHERE d.d_year = 2022 GROUP BY s.s_store_id, s.s_store_sk HAVING SUM(cs.cs_quantity) < ( SELECT SUM(cs2.cs_quantity) FROM catalog_sales cs2 JOIN date_dim d2 ON cs2.cs_sold_date_sk = d2.d_date_sk WHERE cs2.cs_call_center_sk = s.s_store_sk AND d2.d_year = 2023 GROUP BY cs2.cs_call_center_sk ) UNION SELECT s.s_store_id FROM web_sales ws JOIN store s ON ws.ws_web_site_sk = s.s_store_sk JOIN date_dim d ON ws.ws_sold_date_sk = d.d_date_sk WHERE d.d_year = 2022 GROUP BY s.s_store_id, s.s_store_sk HAVING SUM(ws.ws_quantity) < ( SELECT SUM(ws2.ws_quantity) FROM web_sales ws2 JOIN date_dim d2 ON ws2.ws_sold_date_sk = d2.d_date_sk WHERE ws2.ws_web_site_sk = s.s_store_sk AND d2.d_year = 2023 GROUP BY ws2.ws_web_site_sk );
