SELECT i.i_category, i.i_class, d.d_year, SUM(ws.ws_sales_price) AS total_sales, RANK() OVER (PARTITION BY i.i_category, i.i_class ORDER BY SUM(ws.ws_sales_price) DESC) AS sales_rank FROM web_sales ws JOIN item i ON ws.ws_item_sk = i.i_item_sk JOIN date_dim d ON ws.ws_sold_date_sk = d.d_date_sk WHERE d.d_year = ? -- Replace with the desired year GROUP BY ROLLUP(i.i_category, i.i_class, d.d_year) ORDER BY i.i_category, i.i_class, d.d_year;
