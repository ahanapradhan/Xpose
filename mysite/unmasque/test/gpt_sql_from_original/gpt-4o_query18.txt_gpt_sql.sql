SELECT ca.ca_county, AVG(cs.cs_quantity) AS avg_quantity, AVG(cs.cs_list_price) AS avg_list_price, AVG(cs.cs_coupon_amt) AS avg_coupon_amt, AVG(cs.cs_sales_price) AS avg_sales_price, AVG(cs.cs_net_profit) AS avg_net_profit, AVG(EXTRACT(YEAR FROM AGE(CURRENT_DATE, DATE '1900-01-01' + INTERVAL '1 year' * c.c_birth_year)) + c.c_birth_month / 12.0) AS avg_age, AVG(cd.cd_dep_count) AS avg_dependents FROM catalog_sales cs JOIN customer c ON cs.cs_bill_customer_sk = c.c_customer_sk JOIN customer_address ca ON cs.cs_bill_addr_sk = ca.ca_address_sk JOIN customer_demographics cd ON cs.cs_bill_cdemo_sk = cd.cd_demo_sk JOIN date_dim dd ON cs.cs_sold_date_sk = dd.d_date_sk WHERE dd.d_year = ? -- given year AND c.c_birth_month IN (?, ?, ?, ?, ?, ?) -- given list of six months AND ca.ca_state IN (?, ?, ?, ?, ?, ?, ?) -- given list of seven states AND cd.cd_gender = ? -- given gender AND cd.cd_education_status = ? -- given education demographic GROUP BY ca.ca_county;
