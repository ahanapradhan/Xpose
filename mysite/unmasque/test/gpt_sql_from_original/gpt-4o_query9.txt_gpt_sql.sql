WITH sales_buckets AS ( SELECT NTILE(5) OVER (ORDER BY ss_quantity) AS quantity_bucket, ss_ext_discount_amt, ss_sales_price, ss_list_price, ss_ext_tax, ss_net_paid, ss_net_paid_inc_tax, ss_net_profit FROM store_sales ) SELECT quantity_bucket, AVG(ss_ext_discount_amt) AS avg_discount_amount, AVG(ss_sales_price) AS avg_sales_price, AVG(ss_list_price) AS avg_list_price, AVG(ss_ext_tax) AS avg_tax, AVG(ss_net_paid) AS avg_net_paid, AVG(ss_net_paid_inc_tax) AS avg_paid_price_incl_tax, AVG(ss_net_profit) AS avg_net_profit FROM sales_buckets GROUP BY quantity_bucket ORDER BY quantity_bucket;
