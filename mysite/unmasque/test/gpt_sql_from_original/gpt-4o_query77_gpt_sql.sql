SELECT COALESCE(channel, 'Total') AS channel, COALESCE(location_id::VARCHAR, 'All Locations') AS location_id, SUM(total_sales) AS total_sales, SUM(total_returns) AS total_returns, SUM(total_profit) AS total_profit FROM ( SELECT 'Store' AS channel, ss_store_sk AS location_id, SUM(ss_net_paid) AS total_sales, SUM(sr_return_amt) AS total_returns, SUM(ss_net_profit) AS total_profit FROM store_sales JOIN store_returns ON store_sales.ss_item_sk = store_returns.sr_item_sk JOIN date_dim ON store_sales.ss_sold_date_sk = date_dim.d_date_sk WHERE d_date BETWEEN '2001-08-16' AND '2001-09-14' GROUP BY ss_store_sk UNION ALL SELECT 'Catalog' AS channel, cs_catalog_page_sk AS location_id, SUM(cs_net_paid) AS total_sales, SUM(cr_return_amount) AS total_returns, SUM(cs_net_profit) AS total_profit FROM catalog_sales JOIN catalog_returns ON catalog_sales.cs_item_sk = catalog_returns.cr_item_sk JOIN date_dim ON catalog_sales.cs_sold_date_sk = date_dim.d_date_sk WHERE d_date BETWEEN '2001-08-16' AND '2001-09-14' GROUP BY cs_catalog_page_sk UNION ALL SELECT 'Web' AS channel, ws_web_page_sk AS location_id, SUM(ws_net_paid) AS total_sales, SUM(wr_return_amt) AS total_returns, SUM(ws_net_profit) AS total_profit FROM web_sales JOIN web_returns ON web_sales.ws_item_sk = web_returns.wr_item_sk JOIN date_dim ON web_sales.ws_sold_date_sk = date_dim.d_date_sk WHERE d_date BETWEEN '2001-08-16' AND '2001-09-14' GROUP BY ws_web_page_sk ) AS sales_data GROUP BY ROLLUP(channel, location_id::VARCHAR);
