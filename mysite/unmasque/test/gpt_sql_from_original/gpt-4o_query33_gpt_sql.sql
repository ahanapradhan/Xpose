SELECT i.i_manufact_id AS manufacturer_id, SUM(cs.cs_ext_sales_price) AS total_sales, 'Catalog' AS sales_channel FROM catalog_sales cs JOIN item i ON cs.cs_item_sk = i.i_item_sk JOIN date_dim d ON cs.cs_sold_date_sk = d.d_date_sk JOIN call_center cc ON cs.cs_call_center_sk = cc.cc_call_center_sk WHERE i.i_category = 'Books' AND d.d_moy = 3 AND d.d_year = 1999 AND cc.cc_gmt_offset = -5 GROUP BY i.i_manufact_id UNION ALL SELECT i.i_manufact_id AS manufacturer_id, SUM(ss.ss_ext_sales_price) AS total_sales, 'Store' AS sales_channel FROM store_sales ss JOIN item i ON ss.ss_item_sk = i.i_item_sk JOIN date_dim d ON ss.ss_sold_date_sk = d.d_date_sk JOIN store s ON ss.ss_store_sk = s.s_store_sk WHERE i.i_category = 'Books' AND d.d_moy = 3 AND d.d_year = 1999 AND s.s_gmt_offset = -5 GROUP BY i.i_manufact_id UNION ALL SELECT i.i_manufact_id AS manufacturer_id, SUM(ws.ws_ext_sales_price) AS total_sales, 'Web' AS sales_channel FROM web_sales ws JOIN item i ON ws.ws_item_sk = i.i_item_sk JOIN date_dim d ON ws.ws_sold_date_sk = d.d_date_sk JOIN web_site w ON ws.ws_web_site_sk = w.web_site_sk WHERE i.i_category = 'Books' AND d.d_moy = 3 AND d.d_year = 1999 AND w.web_gmt_offset = -5 GROUP BY i.i_manufact_id ORDER BY total_sales DESC, sales_channel;
