SELECT c.c_customer_id, (COALESCE(SUM(cs.cs_net_paid), 0) + COALESCE(SUM(ws.ws_net_paid), 0) - COALESCE(SUM(cr.cr_return_amount), 0) - COALESCE(SUM(wr.wr_return_amt), 0)) AS total_net_cost FROM customer c LEFT JOIN catalog_sales cs ON c.c_customer_sk = cs.cs_bill_customer_sk LEFT JOIN web_sales ws ON c.c_customer_sk = ws.ws_bill_customer_sk LEFT JOIN catalog_returns cr ON c.c_customer_sk = cr.cr_refunded_customer_sk AND cr.cr_reason_sk = 38 LEFT JOIN web_returns wr ON c.c_customer_sk = wr.wr_refunded_customer_sk AND wr.wr_reason_sk = 38 GROUP BY c.c_customer_id;
