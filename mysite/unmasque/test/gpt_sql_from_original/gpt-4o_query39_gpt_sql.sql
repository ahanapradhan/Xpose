WITH MonthlyStats AS ( SELECT inv_item_sk, inv_warehouse_sk, d_month_seq, AVG(inv_quantity_on_hand) AS mean_quantity, STDDEV(inv_quantity_on_hand) AS stddev_quantity FROM inventory JOIN date_dim ON inv_date_sk = d_date_sk WHERE d_year = 2001 AND d_moy IN (1, 2) GROUP BY inv_item_sk, inv_warehouse_sk, d_month_seq ), CoefficientOfVariation AS ( SELECT inv_item_sk, inv_warehouse_sk, d_month_seq, stddev_quantity / NULLIF(mean_quantity, 0) AS coefficient_of_variation FROM MonthlyStats ), FilteredItems AS ( SELECT inv_item_sk, inv_warehouse_sk FROM CoefficientOfVariation WHERE d_month_seq = (SELECT d_month_seq FROM date_dim WHERE d_year = 2001 AND d_moy = 1) AND coefficient_of_variation >= 1.5 ) SELECT inv_item_sk, inv_warehouse_sk FROM FilteredItems;
