SELECT c.c_customer_id, i.i_item_id, SUM(ss.ss_net_paid) AS store_sales, SUM(cs.cs_net_paid + ws.ws_net_paid) AS other_channel_sales, (SUM(ss.ss_net_paid) / NULLIF(SUM(cs.cs_net_paid + ws.ws_net_paid), 0)) AS sales_ratio FROM store_sales ss JOIN customer c ON ss.ss_customer_sk = c.c_customer_sk JOIN item i ON ss.ss_item_sk = i.i_item_sk JOIN date_dim d ON ss.ss_sold_date_sk = d.d_date_sk LEFT JOIN catalog_sales cs ON ss.ss_customer_sk = cs.cs_bill_customer_sk AND ss.ss_item_sk = cs.cs_item_sk AND cs.cs_sold_date_sk = d.d_date_sk LEFT JOIN web_sales ws ON ss.ss_customer_sk = ws.ws_bill_customer_sk AND ss.ss_item_sk = ws.ws_item_sk AND ws.ws_sold_date_sk = d.d_date_sk WHERE d.d_year = 2000 GROUP BY c.c_customer_id, i.i_item_id HAVING SUM(ss.ss_net_paid) > 0 AND SUM(cs.cs_net_paid + ws.ws_net_paid) > 0 AND (SUM(ss.ss_net_paid) / NULLIF(SUM(cs.cs_net_paid + ws.ws_net_paid), 0)) >= 2 ORDER BY sales_ratio DESC;
