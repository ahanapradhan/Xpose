SELECT i.i_item_id, w.w_warehouse_id, d.d_week_seq, SUM(CASE WHEN cs.cs_promo_sk IS NOT NULL THEN 1 ELSE 0 END) AS sales_with_promotion, SUM(CASE WHEN cs.cs_promo_sk IS NULL THEN 1 ELSE 0 END) AS sales_without_promotion FROM catalog_sales cs JOIN item i ON cs.cs_item_sk = i.i_item_sk JOIN warehouse w ON cs.cs_warehouse_sk = w.w_warehouse_sk JOIN date_dim d ON cs.cs_sold_date_sk = d.d_date_sk JOIN customer_demographics cd ON cs.cs_bill_cdemo_sk = cd.cd_demo_sk JOIN household_demographics hd ON cs.cs_bill_hdemo_sk = hd.hd_demo_sk WHERE cd.cd_purchase_estimate > 10000 AND hd.hd_buy_potential = 'D' AND d.d_year = 1999 GROUP BY i.i_item_id, w.w_warehouse_id, d.d_week_seq ORDER BY i.i_item_id, w.w_warehouse_id, d.d_week_seq;
