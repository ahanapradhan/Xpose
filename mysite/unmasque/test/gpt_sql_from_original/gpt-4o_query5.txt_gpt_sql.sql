SELECT COALESCE(sales_channel, 'Total') AS sales_channel, COALESCE(sales_method, 'Total') AS sales_method, SUM(sales) AS total_sales, SUM(profit) AS total_profit, SUM(return_amount) AS total_return_amount, SUM(net_loss) AS total_net_loss FROM ( SELECT 'Store' AS sales_channel, s_store_id AS sales_method, SUM(ss_net_paid) AS sales, SUM(ss_net_profit) AS profit, SUM(sr_return_amt) AS return_amount, SUM(sr_net_loss) AS net_loss FROM store_sales LEFT JOIN store_returns ON store_sales.ss_item_sk = store_returns.sr_item_sk AND store_sales.ss_ticket_number = store_returns.sr_ticket_number JOIN date_dim ON store_sales.ss_sold_date_sk = date_dim.d_date_sk JOIN store ON store_sales.ss_store_sk = store.s_store_sk WHERE d_date BETWEEN CURRENT_DATE - INTERVAL '14 days' AND CURRENT_DATE GROUP BY s_store_id UNION ALL SELECT 'Catalog' AS sales_channel, cp_catalog_page_id AS sales_method, SUM(cs_net_paid) AS sales, SUM(cs_net_profit) AS profit, SUM(cr_return_amount) AS return_amount, SUM(cr_net_loss) AS net_loss FROM catalog_sales LEFT JOIN catalog_returns ON catalog_sales.cs_item_sk = catalog_returns.cr_item_sk AND catalog_sales.cs_order_number = catalog_returns.cr_order_number JOIN date_dim ON catalog_sales.cs_sold_date_sk = date_dim.d_date_sk JOIN catalog_page ON catalog_sales.cs_catalog_page_sk = catalog_page.cp_catalog_page_sk WHERE d_date BETWEEN CURRENT_DATE - INTERVAL '14 days' AND CURRENT_DATE GROUP BY cp_catalog_page_id UNION ALL SELECT 'Web' AS sales_channel, wp_web_page_id AS sales_method, SUM(ws_net_paid) AS sales, SUM(ws_net_profit) AS profit, SUM(wr_return_amt) AS return_amount, SUM(wr_net_loss) AS net_loss FROM web_sales LEFT JOIN web_returns ON web_sales.ws_item_sk = web_returns.wr_item_sk AND web_sales.ws_order_number = web_returns.wr_order_number JOIN date_dim ON web_sales.ws_sold_date_sk = date_dim.d_date_sk JOIN web_page ON web_sales.ws_web_page_sk = web_page.wp_web_page_sk WHERE d_date BETWEEN CURRENT_DATE - INTERVAL '14 days' AND CURRENT_DATE GROUP BY wp_web_page_id ) AS combined_sales GROUP BY ROLLUP(sales_channel, sales_method);
